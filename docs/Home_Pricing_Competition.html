<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Home Pricing Prediction Competition – Seth Kaufman’s Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>



<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Seth Kaufman’s Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-research-reports" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Research Reports</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-research-reports">    
        <li>
    <a class="dropdown-item" href="./Research_Report_1.html">
 <span class="dropdown-text">Bias &amp; Variance Tradeoff and BLUE</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Research_Report_2.html">
 <span class="dropdown-text">Ensemble Learning Techniques for Fair Classification</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="./Home_Pricing_Competition.html">
 <span class="dropdown-text">Home Pricing Prediction Competition</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Applied_Probability_Die_Roll.html">
 <span class="dropdown-text">Conditional Probability Problem</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Electoral_Process.html">
 <span class="dropdown-text">Electoral College Analysis</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Home Pricing Prediction Competition</h1>
<p class="subtitle lead">STA 9890 Final Project</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<p>This is a brief paper reflecting on the final project for STA 9890.</p>
<p>This project focused on data preparation, followed by regression modeling techniques.</p>
<p>Below is an outline for how the project was constructed along with some of the code we ran to get the task done.</p>
<p>The GitHub repository for this project <a href="https://github.com/SethKauf/STA9890-Prediction-Competition/tree/main">can be found here</a>.</p>
</section>
<section id="background-context" class="level1">
<h1>2. Background Context</h1>
<p>For this project, the class was tasked with <a href="https://michael-weylandt.com/STA9890/competition.html">predicting home prices in an unknown metropolitan area out west</a> (later revealed to be the Houston Metro Area).</p>
<p>As a class, we competed with our peers on <a href="https://www.kaggle.com/competitions/baruch-sta-9890-spring-2025"><em>Kaggle</em></a> to submit a prediction-set of homes and their 2019 price, the <code>y-Target</code>.</p>
<p>My best model’s <em>Training RMSE</em> was 24,121 with a Public-Leaderboard score of 42,143 and a Private-Leaderboard score of 43,759 – ranking for 15th place of 27th. Fortunately, our <em>MSE</em> was still fairly reasonable on the leaderboard, though. w This project was entirely done in <code>Python</code> on <code>JupyterNotebook</code>. For simplicity of using a <code>Quarto</code> doc, I’ve migrated the code to R.</p>
<p>You can view the <code>Workfiles</code> here on <a href="https://github.com/SethKauf/STA9890-Prediction-Competition">GitHub</a>.</p>
</section>
<section id="data-formatting-and-eda" class="level1">
<h1>3. Data Formatting and EDA</h1>
<section id="a.-functions" class="level2">
<h2 class="anchored" data-anchor-id="a.-functions">3a. Functions</h2>
<p>The below functions are used in the importation, cleaning and modeling of the data. Some are built based on previous work while others were used during those processes.</p>
<p><code>pip install</code> (or <code>conda install</code>) the needed packages</p>
<div id="e26a8844" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All Libraries Needed</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install numpy pandas seaborn matplotlib scikit-learn xgboost</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Libraries, display settings and site URL</p>
<div id="bb707dba" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>,<span class="dv">50</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>,<span class="dv">100</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.experimental <span class="im">import</span> enable_hist_gradient_boosting</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> HistGradientBoostingRegressor</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBRegressor</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>PATH <span class="op">=</span> <span class="st">'../data/pc/'</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>URL <span class="op">=</span> <span class="st">"https://michael-weylandt.com/STA9890/competition_data/"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Functions</p>
<div id="d7352b2c" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in csv files from site</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_gh(URL, f):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.read_csv(URL <span class="op">+</span> f)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Groups "rare" (low frequency) items from a column</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> group_rare_categories(df, column, threshold<span class="op">=</span><span class="dv">100</span>, new_label<span class="op">=</span><span class="st">'Other'</span>):</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Replace categories in a column that appear fewer than `threshold` times with `new_label`.</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">        df (pd.DataFrame): DataFrame to process</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">        column (str): Name of the column to transform</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">        threshold (int): Frequency threshold below which values are replaced</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">        new_label (str): Label to replace rare categories with</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">        pd.DataFrame: Updated DataFrame with rare values grouped</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    value_counts <span class="op">=</span> df[column].value_counts()</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    rare_values <span class="op">=</span> value_counts[value_counts <span class="op">&lt;</span> threshold].index</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    df[column] <span class="op">=</span> df[column].<span class="bu">apply</span>(<span class="kw">lambda</span> x: new_label <span class="cf">if</span> x <span class="kw">in</span> rare_values <span class="cf">else</span> x)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleans the Building DATAFRAME files</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_building_dfs(df):</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    tfcols <span class="op">=</span> [<span class="st">'elevator'</span>,<span class="st">'has_cooling'</span>,<span class="st">'has_heat'</span>]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> tfcols:</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        df[col] <span class="op">=</span> df[col].fillna(<span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    quality_map <span class="op">=</span> {</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'F'</span>:<span class="dv">0</span>,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'E'</span>:<span class="dv">1</span>,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'D'</span>:<span class="dv">2</span>,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'C'</span>:<span class="dv">3</span>,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B'</span>:<span class="dv">4</span>,</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A'</span>:<span class="dv">5</span>,</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'X'</span>:<span class="dv">6</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'quality'</span>] <span class="op">=</span> df[<span class="st">'quality'</span>].<span class="bu">map</span>(quality_map)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    quality_description_map <span class="op">=</span> {</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Poor'</span>:<span class="dv">0</span>,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Very Low'</span>:<span class="dv">1</span>,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Low'</span>:<span class="dv">2</span>,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Average'</span>:<span class="dv">3</span>,</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Good'</span>:<span class="dv">4</span>,</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Excellent'</span>:<span class="dv">5</span>,</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Superior'</span>:<span class="dv">6</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'quality_description'</span>] <span class="op">=</span> df[<span class="st">'quality_description'</span>].<span class="bu">map</span>(quality_description_map)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    bc_map <span class="op">=</span> {</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Unsound'</span>:<span class="dv">0</span>,</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Very Poor'</span>:<span class="dv">1</span>,</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Poor'</span>:<span class="dv">2</span>,</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Fair'</span>:<span class="dv">3</span>,</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Average'</span>:<span class="dv">4</span>,</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Good'</span>:<span class="dv">5</span>,</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Very Good'</span>:<span class="dv">6</span>,</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Excellent'</span>:<span class="dv">7</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'building_condition'</span>] <span class="op">=</span> df[<span class="st">'building_condition'</span>].<span class="bu">map</span>(bc_map)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    grade_map <span class="op">=</span> {</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">'E-'</span>:<span class="fl">1.3</span>,</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>        <span class="st">'E'</span>:<span class="fl">1.6</span>,</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>        <span class="st">'E+'</span>:<span class="fl">1.9</span>,</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>        <span class="st">'D-'</span>:<span class="fl">2.3</span>,</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">'D'</span>:<span class="fl">2.6</span>,</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>        <span class="st">'D+'</span>:<span class="fl">2.9</span>,</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">'C-'</span>:<span class="fl">3.3</span>,</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">'C'</span>:<span class="fl">3.6</span>,</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">'C+'</span>:<span class="fl">3.9</span>,</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B-'</span>:<span class="fl">4.3</span>,</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B'</span>:<span class="fl">4.6</span>,</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B+'</span>:<span class="fl">4.9</span>,</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'A-'</span>:<span class="fl">5.3</span>,</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">'A'</span>:<span class="fl">5.6</span>,</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>        <span class="st">'A+'</span>:<span class="fl">5.9</span>,</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">'X-'</span>:<span class="fl">6.3</span>,</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">'X'</span>:<span class="fl">6.6</span>,</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">'X+'</span>:<span class="fl">6.9</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'grade'</span>] <span class="op">=</span> df[<span class="st">'grade'</span>].<span class="bu">map</span>(grade_map)</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    pc_map <span class="op">=</span> {</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Unsound'</span>:<span class="dv">0</span>,</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Very Poor'</span>:<span class="dv">1</span>,</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Poor'</span>:<span class="dv">2</span>,</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Fair'</span>:<span class="dv">3</span>,</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Average'</span>:<span class="dv">4</span>,</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Good'</span>:<span class="dv">5</span>,</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Very Good'</span>:<span class="dv">6</span>,</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Excellent'</span>:<span class="dv">7</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'physical_condition'</span>] <span class="op">=</span> df[<span class="st">'physical_condition'</span>].<span class="bu">map</span>(pc_map)</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>    df.loc[df[<span class="st">'foundation_type'</span>] <span class="op">==</span> <span class="st">'Basement and Basement'</span>, <span class="st">'foundation_type'</span>] <span class="op">=</span> <span class="st">'Basement'</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>    df.loc[(df[<span class="st">'foundation_type'</span>]<span class="op">==</span><span class="st">'Basement and Slab'</span>)<span class="op">|</span>(df[<span class="st">'foundation_type'</span>]<span class="op">==</span><span class="st">'Crawl Space and Slab'</span>)<span class="op">|</span>(df[<span class="st">'foundation_type'</span>]<span class="op">==</span><span class="st">'Basement and Crawl Space'</span>)<span class="op">|</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>           (df[<span class="st">'foundation_type'</span>]<span class="op">==</span><span class="st">'Basement and Pier and Beam'</span>)<span class="op">|</span>(df[<span class="st">'foundation_type'</span>]<span class="op">==</span><span class="st">'Pier and Beam'</span>)<span class="op">|</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>           (df[<span class="st">'foundation_type'</span>]<span class="op">==</span><span class="st">'Pier and Beam and Pier and Beam'</span>)<span class="op">|</span>(df[<span class="st">'foundation_type'</span>]<span class="op">==</span><span class="st">'Pier and Beam and Slab'</span>),<span class="st">'foundation_type'</span>] <span class="op">=</span> <span class="st">'Mixed'</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    dummies <span class="op">=</span> pd.get_dummies(df[<span class="st">'foundation_type'</span>], prefix<span class="op">=</span><span class="st">'foundation'</span>).astype(<span class="st">'Int64'</span>)</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.concat([df, dummies], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> group_rare_categories(df, <span class="st">'exterior_walls'</span>, threshold<span class="op">=</span><span class="dv">1000</span>, new_label<span class="op">=</span><span class="st">'Other'</span>)</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keywords to extract</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>    keywords <span class="op">=</span> [</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Brick Veneer'</span>,</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Brick Masonry'</span>,</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Concrete Block'</span>,</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Vinyl'</span>,</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Stucco'</span>,</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Stone'</span>,</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Other'</span></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create 1/0 dummy columns based on substring presence</span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> keywords:</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>        col_name <span class="op">=</span> key.replace(<span class="st">' '</span>, <span class="st">'_'</span>).lower()  <span class="co"># e.g., 'Brick Veneer' → 'brick_veneer'</span></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>        df[col_name] <span class="op">=</span> df[<span class="st">'exterior_walls'</span>].fillna(<span class="st">''</span>).<span class="bu">str</span>.contains(key).astype(<span class="st">'int8'</span>)</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.drop([<span class="st">'exterior_walls'</span>,<span class="st">'foundation_type'</span>],axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a><span class="co"># appends new accounts to running list of unique accounts</span></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> append_new_accts(df_base, df_new, year):</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>    existing_accts <span class="op">=</span> <span class="bu">set</span>(df_base[<span class="st">'acct'</span>])</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>    new_entries <span class="op">=</span> df_new[<span class="op">~</span>df_new[<span class="st">'acct'</span>].isin(existing_accts)][[<span class="st">'acct'</span>]].copy()</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>    new_entries[<span class="st">'year'</span>] <span class="op">=</span> year</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.concat([df_base,new_entries],ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to count occurrances of a specific string value</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_values(df,value:<span class="bu">str</span>):</span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns printout of whatever character you're looking for across the dataset</span></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>    total_rows <span class="op">=</span> <span class="bu">len</span>(df)</span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>    val_counts <span class="op">=</span> []</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> (df[col] <span class="op">==</span> value).<span class="bu">sum</span>()</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>            percent <span class="op">=</span> (count <span class="op">/</span> total_rows) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>            val_counts.append((col, count, percent))</span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by count descending</span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>    val_counts.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print results</span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Column'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'? Count'</span><span class="sc">:&gt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'</span><span class="sc">% o</span><span class="st">f Rows'</span><span class="sc">:&gt;12}</span><span class="ss">"</span>)</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col, count, percent <span class="kw">in</span> val_counts:</span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>count<span class="sc">:&gt;15,}</span><span class="ss"> </span><span class="sc">{</span>percent<span class="sc">:&gt;11.2f}</span><span class="ss">%"</span>)</span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a><span class="co"># function to count NULLs in the columns of a df</span></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_nulls(df, top_n<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>    total_rows <span class="op">=</span> <span class="bu">len</span>(df)</span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>    null_counts <span class="op">=</span> []</span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> df[col].isna().<span class="bu">sum</span>()</span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>            percent <span class="op">=</span> (count <span class="op">/</span> total_rows) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>            null_counts.append((col, count, percent))</span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by null count descending</span></span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>    null_counts.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print total number of columns with NULLs</span></span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Total number of columns with NULLs: </span><span class="sc">{</span><span class="bu">len</span>(null_counts)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If there are NULLs, display formatted table</span></span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> null_counts:</span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Column'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'NULL Count'</span><span class="sc">:&gt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'</span><span class="sc">% o</span><span class="st">f Rows'</span><span class="sc">:&gt;12}</span><span class="ss">"</span>)</span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col, count, percent <span class="kw">in</span> null_counts[:top_n]:</span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>count<span class="sc">:&gt;15,}</span><span class="ss"> </span><span class="sc">{</span>percent<span class="sc">:&gt;11.2f}</span><span class="ss">%"</span>)</span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"No NULLs found in the DataFrame."</span>)</span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a><span class="co"># create model printout</span></span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_scores():</span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Model'</span>: [</span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>          <span class="st">'OLS'</span>, <span class="st">'LASSO'</span>, <span class="st">'Ridge'</span>, <span class="st">'RidgeCV'</span>,</span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>          <span class="st">'XGBR'</span>,<span class="st">'XGBR_GS'</span>,<span class="st">'LGBM'</span>,<span class="st">'Ensemble'</span>,</span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Stack_1'</span>,<span class="st">'Stack_2'</span>,<span class="st">'Stack_3'</span></span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>          ],</span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Train RMSE'</span>: [</span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>          <span class="fl">42103.47</span>, <span class="fl">48757.61</span>, <span class="fl">42101.38</span>, <span class="fl">42101.38</span>,</span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>          <span class="fl">24121.34</span>, <span class="fl">40700.99</span>, <span class="fl">42000.00</span>, <span class="fl">41068.07</span>,</span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>          <span class="fl">43313.99</span>, <span class="fl">37393.21</span>, <span class="fl">33441.12</span></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>          ],</span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Test RMSE (Public)'</span>: [</span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>          <span class="fl">48478.35</span>, <span class="fl">46676.85</span>, <span class="fl">48857.30</span>, <span class="fl">47080.00</span>,</span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>          <span class="fl">42143.88</span>, <span class="fl">43196.91</span>, <span class="fl">170263.72</span>, <span class="fl">44709.20</span>,</span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>          <span class="fl">43589.06</span>, <span class="fl">42896.77</span>, <span class="fl">45241.33</span></span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>          ],</span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Test RMSE (Private)'</span>: [</span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>          <span class="fl">46903.05</span>, <span class="fl">45345.82</span>, <span class="fl">47746.13</span>, <span class="fl">45075.56</span>,</span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>          <span class="fl">43759.64</span>, <span class="fl">44054.83</span>, <span class="fl">174621.3</span>, <span class="fl">44458.82</span>,</span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>          <span class="fl">44946.14</span>, <span class="fl">44380.56</span>, <span class="fl">44128.42</span></span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>          ]</span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>    df_melted <span class="op">=</span> df.melt(id_vars<span class="op">=</span><span class="st">'Model'</span>, value_vars<span class="op">=</span>[<span class="st">'Train RMSE'</span>, <span class="st">'Test RMSE (Public)'</span>, <span class="st">'Test RMSE (Private)'</span>],</span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>                    var_name<span class="op">=</span><span class="st">'Metric'</span>, value_name<span class="op">=</span><span class="st">'RMSE'</span>)</span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>, rc<span class="op">=</span>{<span class="st">"axes.facecolor"</span>: <span class="st">"#ebebeb"</span>})  <span class="co"># slightly grayer</span></span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sns.set(style="whitegrid", rc={"axes.facecolor": "#d3d3d3"})  # slightly darker gray</span></span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>, rc<span class="op">=</span>{</span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a>      <span class="st">"axes.facecolor"</span>: <span class="st">"#d3d3d3"</span>,    <span class="co"># inside the plot</span></span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>      <span class="st">"figure.facecolor"</span>: <span class="st">"#d3d3d3"</span>,  <span class="co"># everything around it</span></span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a>      <span class="st">"grid.color"</span>: <span class="st">"black"</span>,</span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a>      <span class="st">"grid.linewidth"</span>: <span class="fl">0.5</span></span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>    bar <span class="op">=</span> sns.barplot(data<span class="op">=</span>df_melted, x<span class="op">=</span><span class="st">'Model'</span>, y<span class="op">=</span><span class="st">'RMSE'</span>, hue<span class="op">=</span><span class="st">'Metric'</span>, palette<span class="op">=</span><span class="st">'mako'</span>)</span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add value labels</span></span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for p in bar.patches:</span></span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     height = p.get_height()</span></span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     if not pd.isna(height):</span></span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         bar.annotate(f'{height:,.0f}',</span></span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                      (p.get_x() + p.get_width() / 2, height),</span></span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                      ha='center', va='bottom', fontsize=9)</span></span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add horizontal line for best (lowest) Test RMSE</span></span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a>    min_test_rmse_pub <span class="op">=</span> df[<span class="st">'Test RMSE (Public)'</span>].<span class="bu">min</span>()</span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>    plt.axhline(min_test_rmse_pub, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'darkgreen'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">'Best Test RMSE (Public) = 42,144'</span>)</span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>    <span class="co"># same but for private leaderboard</span></span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a>    min_test_rmse_priv <span class="op">=</span> df[<span class="st">'Test RMSE (Private)'</span>].<span class="bu">min</span>()</span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>    plt.axhline(min_test_rmse_priv, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'darkblue'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">'Best Test RMSE (Private) = 43,760'</span>)</span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bold titles and labels</span></span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Train vs Test RMSE by Model"</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"RMSE"</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Model"</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a>    plt.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Read in the data from the website:</p>
<div id="3034dc27" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in from prof's website</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>BUILDING_DETAILS_2015 <span class="op">=</span> read_gh(URL, <span class="st">"building_details_2015.csv.gz"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>BUILDING_DETAILS_2016 <span class="op">=</span> read_gh(URL, <span class="st">"building_details_2016.csv.gz"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>BUILDING_DETAILS_2017 <span class="op">=</span> read_gh(URL, <span class="st">"building_details_2017.csv.gz"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>BUILDING_DETAILS_2018 <span class="op">=</span> read_gh(URL, <span class="st">"building_details_2018.csv.gz"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>BUILDING_DETAILS_2019 <span class="op">=</span> read_gh(URL, <span class="st">"building_details_2019.csv.gz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Clean DFs using function:</p>
<div id="8d18ae2c" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df15 <span class="op">=</span> clean_building_dfs(BUILDING_DETAILS_2015)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df16 <span class="op">=</span> clean_building_dfs(BUILDING_DETAILS_2016)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df17 <span class="op">=</span> clean_building_dfs(BUILDING_DETAILS_2017)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>df18 <span class="op">=</span> clean_building_dfs(BUILDING_DETAILS_2018)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>df19 <span class="op">=</span> clean_building_dfs(BUILDING_DETAILS_2019)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="b.-data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="b.-data-preparation">3b. Data Preparation</h2>
<p>With the data read in, the next part focuses on cleaning and normalizing the data for EDA and modeling.</p>
<p>The cells have been folded or hidden for readability.</p>
<div id="6825fa1e" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_long <span class="op">=</span> df15[[<span class="st">'acct'</span>]].copy()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df_long[<span class="st">'year'</span>] <span class="op">=</span> <span class="dv">2015</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df, yr <span class="kw">in</span> <span class="bu">zip</span>([df16, df17, df18, df19], [<span class="dv">2016</span>, <span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>]):</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    df_long <span class="op">=</span> append_new_accts(df_long, df, yr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="529d2cb3" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>static_cols <span class="op">=</span> [</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'year_built'</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'foundation_Basement'</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'foundation_Crawl Space'</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'foundation_Slab'</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'foundation_Mixed'</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>year_df_map <span class="op">=</span> {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2015</span>: df15,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2016</span>: df16,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2017</span>: df17,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2018</span>: df18,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2019</span>: df19</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> static_cols:</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    df_long[col] <span class="op">=</span> np.nan</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year, df_source <span class="kw">in</span> year_df_map.items():</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get only accounts from df_long for that year</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    acct_subset <span class="op">=</span> df_long[df_long[<span class="st">'year'</span>] <span class="op">==</span> year][[<span class="st">'acct'</span>]]</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pull static columns from the matching year's DataFrame</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    df_extract <span class="op">=</span> df_source[[<span class="st">'acct'</span>] <span class="op">+</span> static_cols]</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge on acct (only updates matching rows)</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    df_long <span class="op">=</span> df_long.merge(df_extract, on<span class="op">=</span><span class="st">'acct'</span>, how<span class="op">=</span><span class="st">'left'</span>, suffixes<span class="op">=</span>(<span class="st">''</span>, <span class="st">'_tmp'</span>))</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Only assign static values where year matches (to avoid overwriting)</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> static_cols:</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        df_long.loc[df_long[<span class="st">'year'</span>] <span class="op">==</span> year, col] <span class="op">=</span> df_long.loc[df_long[<span class="st">'year'</span>] <span class="op">==</span> year, <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_tmp'</span>]</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        df_long.drop(columns<span class="op">=</span>[<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_tmp'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>all_columns <span class="op">=</span> df15.columns.tolist()</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>exclude_cols <span class="op">=</span> [<span class="st">'acct'</span>, <span class="st">'year'</span>] <span class="op">+</span> static_cols  <span class="co"># static_cols from before</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>first_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> all_columns <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> exclude_cols]</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year, df_source <span class="kw">in</span> year_df_map.items():</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    acct_subset <span class="op">=</span> df_long[df_long[<span class="st">'year'</span>] <span class="op">==</span> year][[<span class="st">'acct'</span>]]</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pull and rename first_cols → tmp cols</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    df_extract <span class="op">=</span> df_source[[<span class="st">'acct'</span>] <span class="op">+</span> first_cols].copy()</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    df_extract.rename(columns<span class="op">=</span>{col: <span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_tmp"</span> <span class="cf">for</span> col <span class="kw">in</span> first_cols}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge by acct</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    df_long <span class="op">=</span> df_long.merge(df_extract, on<span class="op">=</span><span class="st">'acct'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign year-specific values</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> first_cols:</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>        tmp_col <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_tmp'</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>        new_col <span class="op">=</span> <span class="ss">f'first_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> new_col <span class="kw">not</span> <span class="kw">in</span> df_long:</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>            df_long[new_col] <span class="op">=</span> np.nan</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>        df_long.loc[df_long[<span class="st">'year'</span>] <span class="op">==</span> year, new_col] <span class="op">=</span> df_long.loc[df_long[<span class="st">'year'</span>] <span class="op">==</span> year, tmp_col]</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>        df_long.drop(columns<span class="op">=</span>[tmp_col], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="191591d1" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a set to track seen accounts</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a set to track seen accounts</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>seen_accts <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with a copy of df_long to add 'end_' columns to</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>df_long_end <span class="op">=</span> df_long.copy()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create placeholders for all end_ columns</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> first_cols:</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    df_long_end[<span class="ss">f'end_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> np.nan</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop in reverse order: 2019 -&gt; 2015</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year, df_source <span class="kw">in</span> <span class="bu">reversed</span>(<span class="bu">list</span>(year_df_map.items())):</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find accounts in this year that haven't been assigned yet</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    df_year_accts <span class="op">=</span> df_source[[<span class="st">'acct'</span>]].copy()</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    new_accts <span class="op">=</span> df_year_accts[<span class="op">~</span>df_year_accts[<span class="st">'acct'</span>].isin(seen_accts)]</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep track of which accounts we've already assigned from later years</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    seen_accts.update(new_accts[<span class="st">'acct'</span>])</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pull and rename cols → tmp</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    df_extract <span class="op">=</span> df_source[[<span class="st">'acct'</span>] <span class="op">+</span> first_cols].copy()</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    df_extract.rename(columns<span class="op">=</span>{col: <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_tmp'</span> <span class="cf">for</span> col <span class="kw">in</span> first_cols}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge with current df_long_end</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    df_long_end <span class="op">=</span> df_long_end.merge(df_extract, on<span class="op">=</span><span class="st">'acct'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign values for those just-seen accounts</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> first_cols:</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        tmp_col <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_tmp'</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        end_col <span class="op">=</span> <span class="ss">f'end_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> df_long_end[<span class="st">'acct'</span>].isin(new_accts[<span class="st">'acct'</span>])</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>        df_long_end.loc[mask, end_col] <span class="op">=</span> df_long_end.loc[mask, tmp_col]</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        df_long_end.drop(columns<span class="op">=</span>[tmp_col], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> first_cols:</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    start_col <span class="op">=</span> <span class="ss">f'first_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    end_col <span class="op">=</span> <span class="ss">f'end_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    delta_col <span class="op">=</span> <span class="ss">f'delta_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    df_long_end[delta_col] <span class="op">=</span> df_long_end[end_col] <span class="op">-</span> df_long_end[start_col]</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Num of unique accounts: </span><span class="sc">{</span>df_long_end[<span class="st">'acct'</span>]<span class="sc">.</span>nunique()<span class="sc">:,.0f}</span><span class="ss">"</span>)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"DataFrame Shape: "</span>, df_long_end.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Num of unique accounts: 1,046,929
DataFrame Shape:  (1046944, 94)</code></pre>
</div>
</div>
<p>The next part pulls in the training and testing data from the website, merging in any information for each <code>account</code> (unique house ID).</p>
<div id="82adf69d" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df_long_end.copy()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> read_gh(URL,<span class="st">"assessment_history_train.csv.gz"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> read_gh(URL,<span class="st">"assessment_history_test.csv.gz"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> train.merge(df, on <span class="op">=</span> <span class="st">'acct'</span>, how <span class="op">=</span> <span class="st">'left'</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> test.merge(df, on <span class="op">=</span> <span class="st">'acct'</span>, how <span class="op">=</span> <span class="st">'left'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>object_cols <span class="op">=</span> train.select_dtypes(include<span class="op">=</span><span class="st">'object'</span>).columns.tolist()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>object_cols.remove(<span class="st">'acct'</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>prots <span class="op">=</span> [<span class="st">'protested_2015'</span>,<span class="st">'protested_2016'</span>,<span class="st">'protested_2017'</span>,<span class="st">'protested_2018'</span>]</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>train[prots] <span class="op">=</span> train[prots].fillna(<span class="va">False</span>).astype(<span class="st">'int8'</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> prots:</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    object_cols.remove(c)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> object_cols:</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    freq <span class="op">=</span> train[col].value_counts()</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    train[<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_freq'</span>] <span class="op">=</span> train[col].<span class="bu">map</span>(freq)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>object_cols <span class="op">=</span> test.select_dtypes(include<span class="op">=</span><span class="st">'object'</span>).columns.tolist()</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>object_cols.remove(<span class="st">'acct'</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>test[prots] <span class="op">=</span> test[prots].fillna(<span class="va">False</span>).astype(<span class="st">'int8'</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> object_cols:</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    freq <span class="op">=</span> test[col].value_counts()</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    test[<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_freq'</span>] <span class="op">=</span> test[col].<span class="bu">map</span>(freq)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>train.drop(object_cols,axis<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>test.drop(object_cols,axis<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="data-overview" class="level1">
<h1>4. Data Overview</h1>
<p>We were given survey data for a little over 1 million homes between 2015 - 2019.</p>
<p>The data came in several categories:</p>
<ul>
<li><p>Building Data</p></li>
<li><p>Quality</p></li>
<li><p>Base Materials</p></li>
<li><p>Dimensions</p></li>
<li><p>bedrooms, bathrooms</p></li>
<li><p>floor area</p></li>
<li><p>Amenities</p></li>
<li><p>HVAC, fireplaces, elevators</p></li>
<li><p>Price (<span class="math inline">\(y-Target\)</span> variable)</p></li>
<li><p>Neighborhood Data</p></li>
<li><p>Unique Identifiers for grouping</p></li>
<li><p>On “neighborhood” and “subneighborhood” levels</p></li>
<li><p>School District</p></li>
<li><p>Assessment Data</p></li>
<li><p>When it was assessed within the data</p></li>
<li><p>If the assesment was protested</p></li>
<li><p>Two grades on a scale of <span class="math inline">\(F\)</span> to <span class="math inline">\(X\)</span> and <span class="math inline">\(E-\)</span> to <span class="math inline">\(X+\)</span> (really bad to really good)</p></li>
</ul>
<section id="a.-combining-the-data" class="level2">
<h2 class="anchored" data-anchor-id="a.-combining-the-data">4a. Combining the Data</h2>
<p>The datafiles themselves were frequently repetitive, where the 2016 file would contain the same information on the same home from 2015 with little to no change. These files would sometime however only be present in a single file, although rarely. This was good consistency-wise since any changes or transformations done to one file could easily be done on another, however it meant that our data had a lot of duplicated information.</p>
<p>At this point, there were (and are) many ways to approach wrangling this data, while keeping in mind best practices of data hygiene e.g.: preventing data leakage. Because the files had this repetitive data, I decided trying to make the data as year-agnostic as possible would accomplish several tasks:</p>
<ul>
<li><p>Cuts out redundant information</p></li>
<li><p>Fewer features speeds up modeling</p></li>
<li><p>Allows for better generalization</p></li>
</ul>
<p>This led to the dataset having the below-type features, with a <code>first_{feature}</code>, <code>end_{feature}</code> and <code>delta_{feature}</code>-type format. The first instance of a home was found, then the last, with the delta between the two being recorded.</p>
<p>Below is a sample of <code>first_</code>, <code>end_</code> and <code>delta_</code> columns for <code>FLOOR_AREA_PRIMARY</code>.</p>
<div id="247c0c8d" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>train[[<span class="st">'first_floor_area_primary'</span>,<span class="st">'end_floor_area_primary'</span>,<span class="st">'delta_floor_area_primary'</span>]].sample(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">first_floor_area_primary</th>
<th data-quarto-table-cell-role="th">end_floor_area_primary</th>
<th data-quarto-table-cell-role="th">delta_floor_area_primary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">201166</td>
<td>1104.0</td>
<td>1104.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">400111</td>
<td>1493.0</td>
<td>1493.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">367158</td>
<td>1620.0</td>
<td>1620.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">391720</td>
<td>1960.0</td>
<td>1960.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The next step was merging this information onto the <code>train</code> file pulled down from the competition website.</p>
</section>
<section id="b.-data-encoding" class="level2">
<h2 class="anchored" data-anchor-id="b.-data-encoding">4b. Data Encoding</h2>
<p>Once we learned and mapped what the data meant, we converted all features to numeric ones for ease of modeling.</p>
<p>This was done in one of several ways:</p>
<ul>
<li><p>Binarizing True/False-like labels</p></li>
<li><p>Dummy/Categorical Encoding for values in features where <span class="math inline">\(n \geq 1000\)</span></p>
<ul>
<li><code>foundation_Slab</code> as an example, where the original column was <code>foundation</code> and the value <code>Slab</code> occurs about <span class="math inline">\(90\%\)</span> of the time.</li>
</ul></li>
<li><p><strong>Frequency Encoding</strong> High-Cardinality features such as <code>Neighborhood</code></p></li>
<li><p>We also considered <strong>Target Encoding</strong> here but did not use it</p></li>
<li><p><strong>Ordinal Encoding</strong> the grades</p></li>
<li><p>The various <code>grades</code> features were ordinally-encoded in slightly different variations. Usually a scale of <span class="math inline">\(worst\space quality = 0\)</span> and <span class="math inline">\(best\space quality = 6\space or\space 7\)</span>. These ranges were done on vibes and vibes alone, but were fairly consistent.</p></li>
</ul>
<p>Below is an example of a <code>dummy</code> foundation column for <code>Slab</code>.</p>
<div id="a23029cc" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># value Slab from the foundation column in the training data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>train[<span class="st">'foundation_Slab'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>1.0    0.897983
0.0    0.102017
Name: foundation_Slab, dtype: float64</code></pre>
</div>
</div>
<p>Below is an example of an encoded cardinal column for home quality.</p>
<div id="79c9c1a2" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ordinal-encoded `end_quality` feature</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>train[<span class="st">'end_quality'</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>).sort_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>0.0         1
1.0      2099
2.0     46854
3.0    382837
4.0    150137
5.0     36518
6.0      5709
NaN      4132
Name: end_quality, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="c.-null-values" class="level2">
<h2 class="anchored" data-anchor-id="c.-null-values">4c. NULL Values</h2>
<p>NULLs presented a large problem in the dataset. Of the <code>128</code> potential features, <code>114</code> had at least one record with a <code>NULL</code> value in <code>train</code> (~89%) with <code>117</code> having a <code>NULL</code> in <code>test</code> (~91%).</p>
<div id="64f1982a" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>count_nulls(train,top_n<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total number of columns with NULLs: 114

Column                              NULL Count    % of Rows
------------------------------------------------------------
building_area_2015                      37,409        5.95%
land_area_2015                          37,409        5.95%
building_value_2015                     37,409        5.95%
land_value_2015                         37,409        5.95%
assessed_2015                           37,409        5.95%
building_area_2016                      28,603        4.55%
land_area_2016                          28,603        4.55%
building_value_2016                     28,603        4.55%
land_value_2016                         28,603        4.55%
assessed_2016                           28,603        4.55%</code></pre>
</div>
</div>
<p>The approach used is a <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.HistGradientBoostingRegressor.html"><strong>Histogram-based Gradient Boosting Regression Tree</strong></a> from the <code>scikit-learn</code> library.</p>
<p>This estimator works well with big datasets such as this one, and especially works well with <code>NULL</code> values.</p>
<p>The idea is, for each column, a sample model of 100,000 records is built and predicts unique values on to that column, imputing the <code>NULL</code> values with an educated guess.</p>
<p>Ultimately, it was the chosen approach of the three considered:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 27%">
<col style="width: 33%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Description</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean/Median Imputation</td>
<td>Impute NULL values with a feature’s mean or median</td>
<td>- Very quick to implement and for a computer to do <br> - Good for continuous data</td>
<td>- Mean is sensitive to outliers <br> - Ignores feature relationships</td>
</tr>
<tr class="even">
<td>BFILL / FFILL</td>
<td>“Fill” missing values with the previous or next value in sequence (e.g., year)</td>
<td>- Preserves temporal continuity <br> - Likely realistic for time series like house values</td>
<td>- May introduce leakage if improperly ordered <br> - Reduces temporal flexibility <br> - We’re trying to be more year-agnostic, not less</td>
</tr>
<tr class="odd">
<td><code>HistGradientBoostingRegressor</code></td>
<td>Trains a model to predict and impute <code>NULL</code> values using the non-missing portion of the dataset</td>
<td>- Produces informed imputations using other feature patterns <br> - Maintains multivariate relationships <br> - Can handle nonlinearities and interactions well</td>
<td>- Risk of overfitting if used on training data without cross-validation <br> - Slower than simple imputers <br> - Can be complex to pipeline correctly</td>
</tr>
</tbody>
</table>
<p>The below code finds all <code>NULLs</code> and uses <code>HistGradientBoostingRegressor</code> to impute them for the training and testing data respectively.</p>
<div id="50b0a4f6" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>missing_cols <span class="op">=</span> train.columns[train.isnull().<span class="bu">any</span>()]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> missing_cols:</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    df_not_missing <span class="op">=</span> train[train[col].notnull()]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    df_missing <span class="op">=</span> train[train[col].isnull()]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> train.columns <span class="cf">if</span> f <span class="op">!=</span> col]</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    X_missing <span class="op">=</span> df_missing[features].select_dtypes(exclude<span class="op">=</span><span class="st">'object'</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample training data</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    df_sample <span class="op">=</span> df_not_missing.sample(n<span class="op">=</span><span class="dv">100000</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> df_sample[features].select_dtypes(exclude<span class="op">=</span><span class="st">'object'</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> df_sample[col]</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> HistGradientBoostingRegressor()</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> model.predict(X_missing)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    train.loc[train[col].isnull(), col] <span class="op">=</span> preds</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of missing columns in the training data: </span><span class="sc">{</span><span class="bu">len</span>(missing_cols)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Number of missing columns in the training data: 114</code></pre>
</div>
</div>
<div id="486a212d" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>missing_cols <span class="op">=</span> test.columns[test.isnull().<span class="bu">any</span>()]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> missing_cols:</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    df_not_missing <span class="op">=</span> test[test[col].notnull()]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    df_missing <span class="op">=</span> test[test[col].isnull()]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> test.columns <span class="cf">if</span> f <span class="op">!=</span> col]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    X_missing <span class="op">=</span> df_missing[features].select_dtypes(exclude<span class="op">=</span><span class="st">'object'</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample training data</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    df_sample <span class="op">=</span> df_not_missing.sample(n<span class="op">=</span><span class="dv">100000</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> df_sample[features].select_dtypes(exclude<span class="op">=</span><span class="st">'object'</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> df_sample[col]</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> HistGradientBoostingRegressor()</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> model.predict(X_missing)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    test.loc[test[col].isnull(), col] <span class="op">=</span> preds</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of missing columns in the testing data: </span><span class="sc">{</span><span class="bu">len</span>(missing_cols)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of missing columns in the testing data: 113</code></pre>
</div>
</div>
</section>
</section>
<section id="modeling" class="level1">
<h1>5. Modeling</h1>
<section id="a.-models-used" class="level2">
<h2 class="anchored" data-anchor-id="a.-models-used">5a. Models Used</h2>
<p>The <em>First Simple Model</em> was an <code>sklearn.linear_model</code> simple <em>OLS-Regression</em> (<code>LinearRegression()</code>) model, which had a 42,103 <em>Train RMSE</em> and 48,478 <em>Test RMSE</em>, which was an encouraging result.</p>
<p>The subsequent three models tried were variations of <span class="math inline">\(\ell_p\)</span> modeling:</p>
<ul>
<li><p>LASSO</p></li>
<li><p>Ridge</p></li>
<li><p>RidgeCV</p></li>
</ul>
<p>With <code>GridSearch</code> being used to find the best parameters for each on a validation set. Of the three, <em>LASSO</em> saw the most improvement, bringing the <em>Test RMSE</em> to 46,677.</p>
<p>Ridge CV had an issue initially of returning <span class="math inline">\(\hat y\)</span> as negative values, so its output had to be constrained. This could be an indicator of an underlying non-linear nature in the data.</p>
<p>Next were two variations of <em>XGBoost Regressor</em>, the first with no hyperparameters and the second using <code>GridSearch</code> to find the best paramaters on the validation/holdout set.</p>
<p>The <em>XGBoost Regressor</em> scored an astonishing 24,121 <em>Train RMSE</em>, while the <code>GridSearch</code> variation scored 40,701. The former of these would post a <em>Test RMSE</em> of 42,144 which would be our team’s best score in the competition.</p>
<p>The performance of the <code>LightGBM</code> model on the validation set varied depending on the number of columns used during training. Since the test set was missing columns such as <code>land_value_2019</code>, <code>assessed_2019</code>, and <code>building_value_2019</code>, we evaluated the model’s performance both with and without these features. When these three columns were excluded, the average RMSE ranged between ~50K and 55K. However, including them improved the RMSE to between ~40K and 45K.</p>
<p>For our final Kaggle submission, we chose to model these three columns separately, as the RMSE on the training set was significantly lower when they were included. Unfortunately, our Kaggle submission resulted in an RMSE of 174,621. Upon further investigation, we discovered that the order of columns in the test set differed slightly from that in the training set. This mismatch likely contributed to the large discrepancy between our validation and test performance.</p>
<p>Finally, one <code>Ensemble</code> and three <code>Stack</code> models were trained.</p>
<p>The <code>Ensemble</code> first used three models, <code>XGBRegressor</code>, <code>BayesianRidge</code> and <code>Ridge</code>. A simple linear estimator was trained using the weighted inference of each model, with the weights being proportional to the <em>Train RMSE</em> of the three models.</p>
<p>The <code>Stack</code> models similar to the <code>Ensemble</code> had three training models with a final <strong>meta-model</strong> such as a <code>Ridge</code> regressor or <code>XGBRegressor</code> which would use <code>NumPy</code> to stack and ultimately predict using.</p>
</section>
<section id="b.-final-model-simple-xgboost-regressor" class="level2">
<h2 class="anchored" data-anchor-id="b.-final-model-simple-xgboost-regressor">5b. Final Model: Simple XGBoost Regressor</h2>
<div id="b6c45b90" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># removing some duplicate values</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> train.drop_duplicates(subset<span class="op">=</span><span class="st">'acct'</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> train.drop(columns<span class="op">=</span>[<span class="st">'acct'</span>,<span class="st">'TARGET'</span>])</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> train[<span class="st">'TARGET'</span>]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>xgb <span class="op">=</span> XGBRegressor()</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>xgb.fit(X, y)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>pred_xgb <span class="op">=</span> xgb.predict(X)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>rmse_xgb <span class="op">=</span> np.sqrt(mean_squared_error(y, pred_xgb))</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"XGBoost RMSE: </span><span class="sc">{</span>rmse_xgb<span class="sc">:,.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>XGBoost RMSE: 14,552.16</code></pre>
</div>
</div>
<p>The <em>RMSE</em> produced here is actually better than in the original training set, which is interesting. This shows the model is prone to a good amount of overfitting.</p>
</section>
<section id="c.-results-and-analysis" class="level2">
<h2 class="anchored" data-anchor-id="c.-results-and-analysis">5c. Results and Analysis</h2>
<p>It was a little surprising that the best model was a simple XGBoost Regressor, though best has a massive asterisk. The <em>Train RMSE</em> was nearly half the Submission’s <em>Test RMSE</em>, indicating a good amount of overfitting was occurring.</p>
<p>Attempts at using <code>Ensemble</code> and <code>Stack</code> techniques didn’t seem to produce any better results than what we already saw.</p>
<div id="e9017a80" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>model_scores()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Home_Pricing_Competition_files/figure-html/cell-18-output-1.png" width="1329" height="560" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="future-steps" class="level1">
<h1>6. Future Steps</h1>
<p>There’s a lot of ways to go from here, from the start of the process to the end.</p>
<ol type="1">
<li>Try other data parsing techniques</li>
</ol>
<p>Was the first/end/delta method the best way of dealing with this time-series data?</p>
<p>Further, was <em>Frequency Encoding</em> the way to go for high-cardinality columns, or would <em>Target Encoding</em> have been better? Perhaps something else?</p>
<ol start="2" type="1">
<li>Try different types of <code>NULL</code> imputation</li>
</ol>
<p>While methods other than the <code>HistGradientBoostingRegressor</code> were considered, it was ultimately decided that this might be the most accurate representation of <code>NULL</code> data. Alternatives included:</p>
<ul>
<li><p>Other forms of imputation as discussed earlier</p></li>
<li><p>Changing the parameters and sample size of the <em>Regressor</em></p></li>
<li><p>Using a different model type</p></li>
<li><p>Keeping the model predictions <code>NULL</code> as we impute columns, eg. not training on already-imputed data</p></li>
</ul>
<ol start="3" type="1">
<li>Try alternative forms of modeling</li>
</ol>
<p>Due to the time factor, models such as <code>RandomForestRegression</code> among several others, were not feasible to use.</p>
<ol start="4" type="1">
<li>Use a hyperparameter tuner such as <code>optuna</code></li>
</ol>
<p>While I only first heard of it during the in-class presentations, this library seems like a much better version of <code>GridSearch</code>.</p>
<ol start="5" type="1">
<li>Model on <code>Colab</code> or in <code>R</code></li>
</ol>
<p>In <code>Colab</code>, we can use the <em>GPU</em> to assist in modeling, which can’t be done in <code>Jupyter</code>.</p>
<p>Modeling in <code>R</code> might have been an alternative approach, as their statistical libraries seem to be more flushed out than <code>Python</code>. Though, for this site, I’ve converted the code from Python to R.</p>
<ol start="6" type="1">
<li>Figure out what caused the greatest reduction in <em>RMSE</em></li>
</ol>
<p>What part of the preprocessing step(s) really helped the model and which did nothing?</p>
</section>
<section id="conclusion" class="level1">
<h1>7. Conclusion</h1>
<p>For the amount of time allotted to complete this project, this was a fairly reasonable result.</p>
<p>It was an interesting project going up against the rest of the class like this and finishing middle-of-the-pack (though a lot closer to the top than the bottom). The positive results that came about after a lot of preprocessing showed that this project was on the right track.</p>
<p>It was also interesting and a bit surprising that linear models still demonstrated strong predictive capabilities and, in some cases, even outperformed more complex algorithms such as LGBM and XGBoost. Additionally, it was valuable to gain hands-on experience with different models by tuning their parameters and evaluating their performance.</p>
<p>After listening to my peers present at the last class, there are a lot of options that could be use if I were to pick up this project again to make a truly great model.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/SethKauf\.github\.io\/Portfolio\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>